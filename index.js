const express = require('express');
const nodemailer = require('nodemailer');
const bodyParser = require('body-parser');
const app = express();
const PORT = process.env.PORT || 3000;

// Middleware to parse incoming JSON requests
app.use(bodyParser.json());

// Endpoint to send emails
app.post('/send-email', async (req, res) => {
  try {
    // Get email details from the request body
    const { email } = req.body;

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });

    const htmlTemplate = `
   <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html style="margin: 0;padding: 0;" xmlns="http://www.w3.org/1999/xhtml"> <head> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <title></title>  <meta http-equiv="X-UA-Compatible" content="IE=edge">  <meta name="viewport" content="width=device-width"> <style type="text/css"> @media only screen and (min-width: 620px) { .column {} .wrapper { min-width: 600px !important } .wrapper h1 {} .wrapper h1 { font-size: 64px !important; line-height: 68px !important } .wrapper h2 {} .wrapper h2 { font-size: 34px !important; line-height: 43px !important } .wrapper h3 {} .wrapper h3 { font-size: 18px !important; line-height: 26px !important } .wrapper .size-8, .wrapper .size-8-m, .wrapper .size-8-l { font-size: 8px !important; line-height: 14px !important } .wrapper .size-8-m { line-height: 16px !important } .wrapper .size-8-l { line-height: 24px !important } .wrapper .size-9, .wrapper .size-9-m, .wrapper .size-9-l { font-size: 9px !important; line-height: 16px !important } .wrapper .size-9-m { line-height: 18px !important } .wrapper .size-9-l { line-height: 27px !important } .wrapper .size-10, .wrapper .size-10-m, .wrapper .size-10-l { font-size: 10px !important; line-height: 18px !important } .wrapper .size-10-m { line-height: 20px !important } .wrapper .size-10-l { line-height: 30px !important } .wrapper .size-11, .wrapper .size-11-m, .wrapper .size-11-l { font-size: 11px !important; line-height: 19px !important } .wrapper .size-11-m { line-height: 22px !important } .wrapper .size-11-l { line-height: 33px !important } .wrapper .size-12, .wrapper .size-12-m, .wrapper .size-12-l { font-size: 12px !important; line-height: 19px !important } .wrapper .size-12-m { line-height: 24px !important } .wrapper .size-12-l { line-height: 36px !important } .wrapper .size-13, .wrapper .size-13-m, .wrapper .size-13-l { font-size: 13px !important; line-height: 21px !important } .wrapper .size-13-m { line-height: 26px !important } .wrapper .size-13-l { line-height: 39px !important } .wrapper .size-14, .wrapper .size-14-m, .wrapper .size-14-l { font-size: 14px !important; line-height: 21px !important } .wrapper .size-14-m { line-height: 28px !important } .wrapper .size-14-l { line-height: 42px !important } .wrapper .size-15, .wrapper .size-15-m, .wrapper .size-15-l { font-size: 15px !important; line-height: 23px !important } .wrapper .size-15-m { line-height: 30px !important } .wrapper .size-15-l { line-height: 45px !important } .wrapper .size-16, .wrapper .size-16-m, .wrapper .size-16-l { font-size: 16px !important; line-height: 24px !important } .wrapper .size-16-m { line-height: 32px !important } .wrapper .size-16-l { line-height: 48px !important } .wrapper .size-17, .wrapper .size-17-m, .wrapper .size-17-l { font-size: 17px !important; line-height: 26px !important } .wrapper .size-17-m { line-height: 34px !important } .wrapper .size-17-l { line-height: 51px !important } .wrapper .size-18, .wrapper .size-18-m, .wrapper .size-18-l { font-size: 18px !important; line-height: 26px !important } .wrapper .size-18-m { line-height: 36px !important } .wrapper .size-18-l { line-height: 54px !important } .wrapper .size-20, .wrapper .size-20-m, .wrapper .size-20-l { font-size: 20px !important; line-height: 28px !important } .wrapper .size-20-m { line-height: 40px !important } .wrapper .size-20-l { line-height: 60px !important } .wrapper .size-22, .wrapper .size-22-m, .wrapper .size-22-l { font-size: 22px !important; line-height: 31px !important } .wrapper .size-22-m { line-height: 44px !important } .wrapper .size-22-l { line-height: 66px !important } .wrapper .size-24, .wrapper .size-24-m, .wrapper .size-24-l { font-size: 24px !important; line-height: 32px !important } .wrapper .size-24-m { line-height: 48px !important } .wrapper .size-24-l { line-height: 72px !important } .wrapper .size-26, .wrapper .size-26-m, .wrapper .size-26-l { font-size: 26px !important; line-height: 34px !important } .wrapper .size-26-m { line-height: 52px !important } .wrapper .size-26-l { line-height: 78px !important } .wrapper .size-28, .wrapper .size-28-m, .wrapper .size-28-l { font-size: 28px !important; line-height: 36px !important } .wrapper .size-28-m { line-height: 56px !important } .wrapper .size-28-l { line-height: 84px !important } .wrapper .size-30, .wrapper .size-30-m, .wrapper .size-30-l { font-size: 30px !important; line-height: 38px !important } .wrapper .size-30-m { line-height: 60px !important } .wrapper .size-30-l { line-height: 90px !important } .wrapper .size-32, .wrapper .size-32-m, .wrapper .size-32-l { font-size: 32px !important; line-height: 40px !important } .wrapper .size-32-m { line-height: 64px !important } .wrapper .size-32-l { line-height: 96px !important } .wrapper .size-34, .wrapper .size-34-m, .wrapper .size-34-l { font-size: 34px !important; line-height: 43px !important } .wrapper .size-34-m { line-height: 68px !important } .wrapper .size-34-l { line-height: 102px !important } .wrapper .size-36, .wrapper .size-36-m, .wrapper .size-36-l { font-size: 36px !important; line-height: 43px !important } .wrapper .size-36-m { line-height: 72px !important } .wrapper .size-36-l { line-height: 108px !important } .wrapper .size-40, .wrapper .size-40-m, .wrapper .size-40-l { font-size: 40px !important; line-height: 47px !important } .wrapper .size-40-m { line-height: 80px !important } .wrapper .size-40-l { line-height: 120px !important } .wrapper .size-44, .wrapper .size-44-m, .wrapper .size-44-l { font-size: 44px !important; line-height: 50px !important } .wrapper .size-44-m { line-height: 88px !important } .wrapper .size-44-l { line-height: 132px !important } .wrapper .size-48, .wrapper .size-48-m, .wrapper .size-48-l { font-size: 48px !important; line-height: 54px !important } .wrapper .size-48-m { line-height: 96px !important } .wrapper .size-48-l { line-height: 144px !important } .wrapper .size-56, .wrapper .size-56-m, .wrapper .size-56-l { font-size: 56px !important; line-height: 60px !important } .wrapper .size-56-m { line-height: 112px !important } .wrapper .size-56-l { line-height: 168px !important } .wrapper .size-64, .wrapper .size-64-m, .wrapper .size-64-l { font-size: 64px !important; line-height: 68px !important } .wrapper .size-64-m { line-height: 128px !important } .wrapper .size-64-l { line-height: 192px !important } .wrapper .size-72, .wrapper .size-72-m, .wrapper .size-72-l { font-size: 72px !important; line-height: 76px !important } .wrapper .size-72-m { line-height: 144px !important } .wrapper .size-72-l { line-height: 216px !important } .wrapper .size-80, .wrapper .size-80-m, .wrapper .size-80-l { font-size: 80px !important; line-height: 84px !important } .wrapper .size-80-m { line-height: 160px !important } .wrapper .size-80-l { line-height: 240px !important } .wrapper .size-96, .wrapper .size-96-m, .wrapper .size-96-l { font-size: 96px !important; line-height: 100px !important } .wrapper .size-96-m { line-height: 192px !important } .wrapper .size-96-l { line-height: 288px !important } .wrapper .size-112, .wrapper .size-112-m, .wrapper .size-112-l { font-size: 112px !important; line-height: 116px !important } .wrapper .size-112-m { line-height: 224px !important } .wrapper .size-112-l { line-height: 336px !important } .wrapper .size-128, .wrapper .size-128-m, .wrapper .size-128-l { font-size: 128px !important; line-height: 132px !important } .wrapper .size-128-m { line-height: 256px !important } .wrapper .size-128-l { line-height: 384px !important } .wrapper .size-144, .wrapper .size-144-m, .wrapper .size-144-l { font-size: 144px !important; line-height: 148px !important } .wrapper .size-144-m { line-height: 288px !important } .wrapper .size-144-l { line-height: 432px !important } } </style> <meta name="x-apple-disable-message-reformatting"> <style type="text/css"> .main, .mso { margin: 0; padding: 0; } table { border-collapse: collapse; table-layout: fixed; } * { line-height: inherit; } [x-apple-data-detectors] { color: inherit !important; text-decoration: none !important; } .wrapper .footer__share-button a:hover, .wrapper .footer__share-button a:focus { color: #ffffff !important; } .wrapper .footer__share-button a.icon-white:hover, .wrapper .footer__share-button a.icon-white:focus { color: #ffffff !important; } .wrapper .footer__share-button a.icon-black:hover, .wrapper .footer__share-button a.icon-black:focus { color: #000000 !important; } .btn a:hover, .btn a:focus, .footer__share-button a:hover, .footer__share-button a:focus, .email-footer__links a:hover, .email-footer__links a:focus { opacity: 0.8; } .preheader, .header, .layout, .column { transition: width 0.25s ease-in-out, max-width 0.25s ease-in-out; } .preheader td { padding-bottom: 8px; } .layout, div.header { max-width: 400px !important; -fallback-width: 95% !important; width: calc(100% - 20px) !important; } div.preheader { max-width: 360px !important; -fallback-width: 90% !important; width: calc(100% - 60px) !important; } .snippet, .webversion { Float: none !important; } .stack .column { max-width: 400px !important; width: 100% !important; } .fixed-width.has-border { max-width: 402px !important; } .fixed-width.has-border .layout__inner { box-sizing: border-box; } .snippet, .webversion { width: 50% !important; } .mso .layout__edges { font-size: 0; } .layout-fixed-width, .mso .layout-full-width { background-color: #ffffff; } @media only screen and (min-width: 620px) { .column, .gutter { display: table-cell; Float: none !important; vertical-align: top; } div.preheader, .email-footer { max-width: 560px !important; width: 560px !important; } .snippet, .webversion { width: 280px !important; } div.header, .layout, .one-col .column { max-width: 600px !important; width: 600px !important; } .fixed-width.has-border, .fixed-width.x_has-border, .has-gutter.has-border, .has-gutter.x_has-border { max-width: 602px !important; width: 602px !important; } .two-col .column { max-width: 300px !important; width: 300px !important; } .three-col .column, .column.narrow, .column.x_narrow { max-width: 200px !important; width: 200px !important; } .column.wide, .column.x_wide { width: 400px !important; } .two-col.has-gutter .column, .two-col.x_has-gutter .column { max-width: 290px !important; width: 290px !important; } .three-col.has-gutter .column, .three-col.x_has-gutter .column, .has-gutter .narrow { max-width: 188px !important; width: 188px !important; } .has-gutter .wide { max-width: 394px !important; width: 394px !important; } .two-col.has-gutter.has-border .column, .two-col.x_has-gutter.x_has-border .column { max-width: 292px !important; width: 292px !important; } .three-col.has-gutter.has-border .column, .three-col.x_has-gutter.x_has-border .column, .has-gutter.has-border .narrow, .has-gutter.x_has-border .narrow { max-width: 190px !important; width: 190px !important; } .has-gutter.has-border .wide, .has-gutter.x_has-border .wide { max-width: 396px !important; width: 396px !important; } } @supports (display: flex) { @media only screen and (min-width: 620px) { .fixed-width.has-border .layout__inner { display: flex !important; } } } /*** * Mobile Styles * * 1. Overriding inline styles */ @media(max-width: 619px) { .email-flexible-footer .left-aligned-footer .column, .email-flexible-footer .center-aligned-footer, .email-flexible-footer .right-aligned-footer .column { max-width: 100% !important; /* [1] */ text-align: center !important; /* [1] */ width: 100% !important; /* [1] */ } .flexible-footer-logo { margin-left: 0px !important; /* [1] */ margin-right: 0px !important; /* [1] */ } .email-flexible-footer .left-aligned-footer .flexible-footer__share-button__container, .email-flexible-footer .center-aligned-footer .flexible-footer__share-button__container, .email-flexible-footer .right-aligned-footer .flexible-footer__share-button__container { display: inline-block; margin-left: 5px !important; /* [1] */ margin-right: 5px !important; /* [1] */ } .email-flexible-footer__additionalinfo--center { text-align: center !important; /* [1] */ } .email-flexible-footer .left-aligned-footer table, .email-flexible-footer .center-aligned-footer table, .email-flexible-footer .right-aligned-footer table { display: table !important; /* [1] */ width: 100% !important; /* [1] */ } .email-flexible-footer .footer__share-button, .email-flexible-footer .email-footer__additional-info { margin-left: 20px; margin-right: 20px; } } @media only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min-device-pixel-ratio: 2), only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx) { .fblike { background-image: url(https://i7.createsend1.com/static/eb/master/13-the-blueprint-3/images/fblike@2x.png) !important; } .tweet { background-image: url(https://i8.createsend1.com/static/eb/master/13-the-blueprint-3/images/tweet@2x.png) !important; } .linkedinshare { background-image: url(https://i9.createsend1.com/static/eb/master/13-the-blueprint-3/images/lishare@2x.png) !important; } .forwardtoafriend { background-image: url(https://i10.createsend1.com/static/eb/master/13-the-blueprint-3/images/forward@2x.png) !important; } } @media (max-width: 321px) { .fixed-width.has-border .layout__inner { border-width: 1px 0 !important; } .layout, .stack .column { min-width: 320px !important; width: 320px !important; } .border { display: none; } .has-gutter .border { display: table-cell; } } .cmctbl--inline table { border-collapse: collapse; } </style>  <style type="text/css"> @import url(https://fonts.googleapis.com/css?family=Montserrat:400,700,400italic,700italic); </style> <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,400italic,700italic" rel="stylesheet" type="text/css">  <style type="text/css"> .main, .mso { background-color: #fbfbfb } .logo a:hover, .logo a:focus { color: #1e2e3b !important } .footer-logo a:hover, .footer-logo a:focus { color: #372d1b !important } .mso .layout-has-border { border-top: 1px solid #c8c8c8; border-bottom: 1px solid #c8c8c8 } .mso .layout-has-bottom-border { border-bottom: 1px solid #c8c8c8 } .mso .border { background-color: #c8c8c8 } .mso h1 {} .mso h1 { font-size: 64px !important; line-height: 68px !important } .mso h2 {} .mso h2 { font-size: 34px !important; line-height: 43px !important } .mso h3 {} .mso h3 { font-size: 18px !important; line-height: 26px !important } .mso .layout__inner {} .mso .footer__share-button p {} .mso .footer__share-button p { font-family: sans-serif } </style>  <meta name="robots" content="noindex,nofollow"> </meta> <meta property="og:title" content=""> </meta> </head>   <body class="main full-padding" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;">  <table class="wrapper" style="border-collapse: collapse;table-layout: fixed;min-width: 320px;width: 100%;background-color: #fbfbfb;" cellpadding="0" cellspacing="0" role="presentation"> <tbody> <tr> <td> <div role="banner"> <div class="header" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px); padding-top: 25px;" id="emb-email-header-container">  <div class="logo emb-logo-margin-box" style="font-size: 26px;line-height: 32px;Margin-top: 6px;Margin-bottom: 20px;color: #41637e;font-family: Avenir,sans-serif;Margin-left: 20px;Margin-right: 20px;" align="center"> <div class="logo-center" align="center" id="emb-email-header"><a style="text-decoration: none;transition: opacity 0.1s ease-in;color: #41637e;" href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${email}"><img style="display: block;height: auto;width: 100%;border: 0;max-width: 212px;" src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" alt="Government Grants Available!!! Upto £30k worth of home heating systems, supplied and installed :)" width="212"></a></div> </div>  </div> </div> <div> <div style="background-color: #4fb126;background: 0px 0px/auto auto repeat url(https://i1.createsend1.com/ei/y/35/EB3/A0B/212507/csfinal/welcomebgpattern.png) #4fb126;background-position: 0px 0px;background-image: url(https://i1.createsend1.com/ei/y/35/EB3/A0B/212507/csfinal/welcomebgpattern.png);background-repeat: repeat;background-size: auto auto;"> <div class="layout one-col stack" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;"> <div class="layout__inner" style="border-collapse: collapse;display: table;width: 100%;">  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 5px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;line-height: 10px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <h1 class="size-40" style="Margin-top: 0;Margin-bottom: 0;font-style: normal;font-weight: normal;color: #fff;font-size: 32px;line-height: 40px;text-align: center;" lang="x-size-40"><span style="text-decoration: inherit;color: #050505;"><strong>Lower your energy Bills by upto 70%*</strong></span></h1> <h1 class="size-36" style="Margin-top: 20px;Margin-bottom: 20px;font-style: normal;font-weight: normal;color: #fff;font-size: 30px;line-height: 38px;text-align: center;" lang="x-size-36"><strong> ECO4 Government Grants available NOW!</strong></h1> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p style="Margin-top: 0;Margin-bottom: 0;line-height: 32px;text-align: center;"><strong>We have checked your eligibility for the ECO4 Government Grant and It looks like you may qualify!</strong></p> <p class="size-15-m" style="Margin-top: 20px;Margin-bottom: 20px;font-size: 15px;line-height: 30px;text-align: center;" lang="x-size-15"><strong>Upto £35,000 Government Grants Available Now!</strong></p> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;line-height: 1px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div class="btn btn--depth btn--large" style="Margin-bottom: 20px;text-align: center;"> <a style="border-radius: 4px;display: inline-block;font-size: 14px;font-weight: bold;line-height: 24px;padding: 12px 24px;text-align: center;text-decoration: none !important;transition: opacity 0.1s ease-in;color: #0a090a !important;border: 1px solid rgba(0, 0, 0, 0.25);box-shadow: inset 0 -3px 0 -1px rgba(0, 0, 0, 0.2), inset 0 2px 1px -1px #ffffff;text-shadow: 0 1px 0 rgba(0, 0, 0, 0.21);background-color: #e07e23;font-family: Montserrat, DejaVu Sans, Verdana, sans-serif;" href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${email}">Check Eligibility</a>   </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p class="size-12" style="Margin-top: 0;Margin-bottom: 0;font-size: 12px;line-height: 19px;text-align: center;" lang="x-size-12"><span style="text-decoration: inherit;color: #080808;">Takes less than 2 minutes</span></p> </div> </div> </div>  </div> </div> </div> <div style="background-color: #e07e23;"> <div class="layout one-col stack" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;"> <div class="layout__inner" style="border-collapse: collapse;display: table;width: 100%;">  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 34px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p style="Margin-top: 0;Margin-bottom: 0;text-align: center;"><strong>REDUCE YOUR ENERGY BILLS </strong></p> <p style="Margin-top: 20px;Margin-bottom: 0;text-align: center;">Free equipment and Installation </p> <p style="Margin-top: 20px;Margin-bottom: 0;text-align: center;">Completely free service</p> <p style="Margin-top: 20px;Margin-bottom: 0;line-height: 32px;text-align: center;">Free to apply </p> <p style="Margin-top: 20px;Margin-bottom: 20px;line-height: 32px;text-align: center;"> <strong>Government Grant Approved</strong></p> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;line-height: 18px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-bottom: 24px;"> <div class="btn btn--depth btn--large" style="text-align:center;"> <a style="border-radius: 4px;display: inline-block;font-size: 14px;font-weight: bold;line-height: 24px;padding: 12px 24px;text-align: center;text-decoration: none !important;transition: opacity 0.1s ease-in;color: #0a090a !important;border: 1px solid rgba(0, 0, 0, 0.25);box-shadow: inset 0 -3px 0 -1px rgba(0, 0, 0, 0.2), inset 0 2px 1px -1px #ffffff;text-shadow: 0 1px 0 rgba(0, 0, 0, 0.21);background-color: #4fb126;font-family: Montserrat, DejaVu Sans, Verdana, sans-serif;" href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${email}">Homeowners/Private Tenants on benefits or low incomes</a>   </div> </div> </div>  </div> </div> </div> <div style="background-color: #ffffff;"> <div class="layout two-col stack" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;"> <div class="layout__inner" style="border-collapse: collapse;display: table;width: 100%;">  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;max-width: 320px;min-width: 300px; width: 320px;width: calc(12300px - 2000%);Float: left;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 1px;"> </div> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 90px;" alt="" width="90" src="https://app.neuzmail.in/files/65771efa8be29/reduce-cost-01-9900000b6d3cf03c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <h3 style="Margin-top: 0;Margin-bottom: 0;font-style: normal;font-weight: normal;color: #009275;font-size: 17px;line-height: 26px;text-align: center;"> Reduced energy bills</h3> </div> </div> </div>  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;max-width: 320px;min-width: 300px; width: 320px;width: calc(12300px - 2000%);Float: left;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 1px;"> </div> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 90px;" alt="" width="90" src="https://app.neuzmail.in/files/65771efa8be29/Warmermoreenergyefficienthome-01-9900000b6d3cf03c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <h3 style="Margin-top: 0;Margin-bottom: 0;font-style: normal;font-weight: normal;color: #009275;font-size: 17px;line-height: 26px;text-align: center;"> Increased Energy Efficiency</h3> </div> </div> </div>  </div> </div> </div> <div style="background-color: #ffffff;"> <div class="layout two-col stack" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;"> <div class="layout__inner" style="border-collapse: collapse;display: table;width: 100%;">  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;max-width: 320px;min-width: 300px; width: 320px;width: calc(12300px - 2000%);Float: left;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 1px;"> </div> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 90px;" alt="" width="90" src="https://app.neuzmail.in/files/65771efa8be29/Co2-01-9900000b6d3cf03c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <h3 style="Margin-top: 0;Margin-bottom: 0;font-style: normal;font-weight: normal;color: #009275;font-size: 17px;line-height: 26px;text-align: center;"> Reduced Carbon Footprint</h3> </div> </div> </div>  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;max-width: 320px;min-width: 300px; width: 320px;width: calc(12300px - 2000%);Float: left;"> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 24px;"> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 1px;"> </div> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 90px;" alt="" width="90" src="https://app.neuzmail.in/files/65771efa8be29/IncreaseyourhouseValue-01-9900000b6d3cf03c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 20px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <h3 style="Margin-top: 0;Margin-bottom: 12px;font-style: normal;font-weight: normal;color: #009275;font-size: 17px;line-height: 26px;text-align: center;"> Increased House Value</h3> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 1px;"> </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div class="btn btn--depth btn--large" style="Margin-bottom: 20px;text-align: center;"> <a style="border-radius: 4px;display: inline-block;font-size: 14px;font-weight: bold;line-height: 24px;padding: 12px 24px;text-align: center;text-decoration: none !important;transition: opacity 0.1s ease-in;color: #0a090a !important;border: 1px solid rgba(0, 0, 0, 0.25);box-shadow: inset 0 -3px 0 -1px rgba(0, 0, 0, 0.2), inset 0 2px 1px -1px #ffffff;text-shadow: 0 1px 0 rgba(0, 0, 0, 0.21);background-color: #4fb126;font-family: Montserrat, DejaVu Sans, Verdana, sans-serif;" href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${email}">Check Eligibility</a>   </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p class="size-12" style="Margin-top: 0;Margin-bottom: 0;font-size: 12px;line-height: 19px;text-align: center;" lang="x-size-12"><span style="text-decoration: inherit;color: #080808;">Takes less than 2 minutes</span></p> </div> </div> </div>  </div> </div> </div> <div style="mso-line-height-rule: exactly;line-height: 20px;font-size: 20px;"> </div> <div class="layout one-col fixed-width stack" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;"> <div class="layout__inner" style="border-collapse: collapse;display: table;width: 100%;background-color: #fbfbfb;">  <div class="column" style="text-align: left;color: #fbfbfb;font-size: 16px;line-height: 24px;font-family: Montserrat,DejaVu Sans,Verdana,sans-serif;"> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img class="gnd-corner-image gnd-corner-image-center gnd-corner-image-top" style="border: 0;display: block;height: auto;width: 100%;max-width: 900px;" alt="" width="600" src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg"> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;Margin-top: 20px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 900px;" alt="" width="600" src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-top: 20px;"> <div class="btn btn--depth btn--large" style="Margin-bottom: 20px;text-align: center;"> <a style="border-radius: 4px;display: inline-block;font-size: 14px;font-weight: bold;line-height: 24px;padding: 12px 24px;text-align: center;text-decoration: none !important;transition: opacity 0.1s ease-in;color: #0a090a !important;border: 1px solid rgba(0, 0, 0, 0.25);box-shadow: inset 0 -3px 0 -1px rgba(0, 0, 0, 0.2), inset 0 2px 1px -1px #ffffff;text-shadow: 0 1px 0 rgba(0, 0, 0, 0.21);background-color: #e07e23;font-family: Montserrat, DejaVu Sans, Verdana, sans-serif;" href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${email}">Check Eligibility</a>   </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p class="size-12" style="Margin-top: 0;Margin-bottom: 20px;font-size: 12px;line-height: 19px;text-align: center;" lang="x-size-12"><span style="text-decoration: inherit;color: #080808;">Takes less than 2 minutes</span></p> </div> </div> <div style="font-size: 12px;font-style: normal;font-weight: normal;line-height: 19px;" align="center"> <img style="border: 0;display: block;height: auto;width: 100%;max-width: 900px;" alt="" width="600" src="https://app.neuzmail.in/files/65771efa8be29/Eco4Grants1-9900000000079e3c.jpg"> </div> <div style="Margin-left: 20px;Margin-right: 20px;"> <div class="divider" style="display: block;font-size: 2px;line-height: 2px;Margin-left: auto;Margin-right: auto;width: 40px;background-color: #c8c8c8;Margin-bottom: 20px;">  </div> </div> <div style="Margin-left: 20px;Margin-right: 20px;Margin-bottom: 24px;"> <div style="mso-line-height-rule: exactly;mso-text-raise: 11px;vertical-align: middle;"> <p class="size-8" style="Margin-top: 0;Margin-bottom: 0;font-size: 8px;line-height: 14px;" lang="x-size-8"><span style="text-decoration: inherit;color: #0f0e0f;"><strong>*Measures and benefits for homeowners and private tenants who qualify</strong></span></p> <p class="size-8" style="Margin-top: 20px;Margin-bottom: 0;font-size: 8px;line-height: 14px;" lang="x-size-8"><span style="text-decoration: inherit;color: #0f0e0f;"><strong>*70% saving may vary dependant on measures installed, size of property, current energy provider and other insulation already in place</strong></span></p> </div> </div> </div>  </div> </div> </div> <div role="contentinfo"> <div style="line-height:4px;font-size:4px;" id="footer-top-spacing"> </div> <div class="layout email-flexible-footer email-footer" style="Margin: 0 auto;max-width: 600px;min-width: 320px; width: 320px;width: calc(28000% - 167400px);overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;" dir="rtl" id="footer-content"> <div class="layout__inner right-aligned-footer" style="border-collapse: collapse;display: table;width: 100%;">    <div class="column" style="text-align: right;font-size: 12px;line-height: 19px;color: #999;font-family: sans-serif;display: none;" dir="ltr"> <div class="footer-logo emb-logo-margin-box" style="font-size: 26px;line-height: 32px;Margin-top: 6px;Margin-bottom: 20px;color: #7b663d;font-family: Roboto,Tahoma,sans-serif;" align="center"> <div emb-flexible-footer-logo align="center"></div> </div> </div>   <div class="column" style="text-align: right;font-size: 12px;line-height: 19px;color: #999;font-family: sans-serif;display: none;" dir="ltr"> <div style="margin-left: 0;margin-right: 0;Margin-top: 10px;Margin-bottom: 10px;"> <div class="footer__share-button"> </div> </div> </div>     </div> </div> <div style="line-height:40px;font-size:40px;" id="footer-bottom-spacing"> </div> </div> </td> </tr> </tbody> </table> <style type="text/css"> @media (max-width:619px) { .email-flexible-footer .left-aligned-footer .column, .email-flexible-footer .center-aligned-footer, .email-flexible-footer .right-aligned-footer .column { max-width: 100% !important; text-align: center !important; width: 100% !important } .flexible-footer-logo { margin-left: 0px !important; margin-right: 0px !important } .email-flexible-footer .left-aligned-footer .flexible-footer__share-button__container, .email-flexible-footer .center-aligned-footer .flexible-footer__share-button__container, .email-flexible-footer .right-aligned-footer .flexible-footer__share-button__container { display: inline-block; margin-left: 5px !important; margin-right: 5px !important } .email-flexible-footer__additionalinfo--center { text-align: center !important } .email-flexible-footer .left-aligned-footer table, .email-flexible-footer .center-aligned-footer table, .email-flexible-footer .right-aligned-footer table { display: table !important; width: 100% !important } .email-flexible-footer .footer__share-button, .email-flexible-footer .email-footer__additional-info { margin-left: 20px; margin-right: 20px } } </style> </body> </html>
    `;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: email,
      subject: 'Upwork Online Survey- Further Info Requested',
      text: 'Lower your energy Bills by upto 70%. ECO4 Government Grants available NOW! ',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully' });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

//  Freshstart ECO4 Application - More Info Required
app.post('/send-email-eco2app', async (req, res) => {
  try {
    // Get email details from the request body
    const {
      apiKey,
      name,
      dataSource,
      email,
      address,
      residentialStatus,
      propertyEPCRating,
      onGasSafeRegister,
      heatingSystem,
      benefitsReceived,
      incomeUnder31k,
      deal_Id
    } = req.body;

    // Function to initialize with "Missing Info" if value is "" or undefined or null
    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedApiKey = initializeWithMissingInfo(apiKey);
    const initializedName = initializeWithMissingInfo(name);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedAddress = initializeWithMissingInfo(address);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedPropertyEPCRating = initializeWithMissingInfo(propertyEPCRating);
    const initializedOnGasSafeRegister = initializeWithMissingInfo(onGasSafeRegister);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedIncomeUnder31k = initializeWithMissingInfo(incomeUnder31k);
    const initializedDealId = initializeWithMissingInfo(deal_Id);


    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " ECO4 Application - More Info Required";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-5" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedAddress} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedPropertyEPCRating}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedOnGasSafeRegister}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedIncomeUnder31k}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/TD38Qc1o#email=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://070fa85585.imgdist.com/public/users/Integrators/BeeProAgency/1023772_1008730/table%20002.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"EcoGrantsOnline/"' + dataSource + '<info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Awaiting Boiler Pictures
app.post('/awaiting-boiler-pictures', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey - more Info required";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}, it was a pleasure speaking to you on the phone.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">As discussed we have assessed the initial information provided below and it looks like you may qualify for the grant (worth upto £35k), however we now need some supporting evidence to progress your application to the next stage (Surveyor).</p> </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information/images of your boiler</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/tcN99sLv#dealid=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"EcoGrantsOnline/"' + dataSource + '<info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected out of criteria
app.post('/rejected-out-of-criteria', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">* information supplied is deemed as out of criteria to be accepted for the Grant </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected boiler issues
app.post('/rejected-boiler-issues', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, heatingSystem, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">Your current heating system ${initializedHeatingSystem} is already too energy efficient. </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected Income too high
app.post('/rejected-income-too-high', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">Your combined household income is too high and nobody in your household is in receipt of a qualifying government benefit. </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected EPC issues
app.post('/rejected-epc-issues', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, epcRating, epcNumber, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">Your Energy Performance Certificate is already too high, your EPC rating is ${initializedEpcRating} ${initializedEpcNumber}. </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected client cancelled
app.post('/rejected-client-cancelled', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">You have requested to cancel the application. </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Rejected on gas safe
app.post('/rejected-on-gas-safe', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, heatingSystem, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedApiKey = initializeWithMissingInfo(apiKey);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, unfortunately you do not qualify for the ECO4 Government Grant because: </p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Reason for Rejection</td> <td class="td-second">Your current heating system ${initializedHeatingSystem} is already deemed too energy efficient. </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We would like to thank you for completing the online survey, if the criteria changes we will be in touch in due course. </p> </div> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">If you would like to speak to someone on our team regarding the above, please call on 0800 9949456 or email us at <a href="mailto:info@ecogrants.online">info@ecogrants.online</a>. </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});


// NEW Leads
app.post('/new-lead', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, heatingSystem, benefitsReceived, householdIncome, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);

    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The Eco4 Grant is designed to improve your standard of living and <span style="font-weight:700;">reduce your monthly heating bills!</span> Giving you a warmer, more energy efficient home whilst reducing your impact on the planet :)</p> </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> <span style="color: red; font-weight: 700;">CHECKING</span></td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> <span style="color: red; font-weight: 700;">CHECKING</span></td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;"> We now need to run some further checks to see if you may qualify</p> </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});


// No Benefits
app.post('/no-benefits', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey - more Info required";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-5" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/x4mDUmcY#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here</span></span></a> </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/x4mDUmcY#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a> </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// Potential Fix
app.post('/potential-fix', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey - more Info required";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-5" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/HCQaQPV6#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/HCQaQPV6#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});


// EPC Not listed / No Benefits
app.post('/epc-notlisted-nobenefits', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-5" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/WGkM9Qx7#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/WGkM9Qx7#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});


// Awaiting Documnts Homeowner
app.post('/awaiting-documents-homeowner', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);
    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " ECO4 Application - More Info Required";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0">   <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css">  <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName},</p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-5" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/EiLxtO0G#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second">${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus}</td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked}</td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived}</td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information.</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/EiLxtO0G#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a>  </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span></td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});


// Awaiting Documnts Tenants
app.post('/awaiting-documents-tenants', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, clientName, dataSource, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, gasSafeChecked, heatingSystem, benefitsReceived, householdIncome, landlordsFirstName, landlordsSurnameName, landlordsEmailAddress, landlordsPhoneNumber, deal_Id, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedDataSource = initializeWithMissingInfo(dataSource);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedGasSafeChecked = initializeWithMissingInfo(gasSafeChecked);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedHouseholdIncome = initializeWithMissingInfo(householdIncome);

    const initializedLandlordsFirstName = initializeWithMissingInfo(landlordsFirstName);
    const initializedLandlordsSurName = initializeWithMissingInfo(landlordsSurnameName);
    const initializedLandlordsEmailAddress = initializeWithMissingInfo(landlordsEmailAddress);
    const initializedLandlordsPhoneNumber = initializeWithMissingInfo(landlordsPhoneNumber);

    const initializedDealId = initializeWithMissingInfo(deal_Id);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedDataSource + " Online Survey - further info requested";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Dear ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for your enquiry regarding the ECO4 Government Grant through ${initializedDataSource}. It was a pleasure speaking to you on the phone.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">We have now completed our preliminary checks, it looks like you qualify but we just need some further information.</p> </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The information you have supplied is as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Address</td> <td class="td-second"> ${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> ${initializedResidentialStatus} </td> </tr> <tr> <td class="td-first">Property EPC Rating</td> <td class="td-second"> ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">On Gas Safe Register</td> <td class="td-second"> ${initializedGasSafeChecked} </td> </tr> <tr> <td class="td-first">Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> <tr> <td class="td-first">Benefits Received</td> <td class="td-second"> ${initializedBenefitsReceived} </td> </tr> <tr> <td class="td-first">Income Under £31k</td> <td class="td-second"> ${initializedHouseholdIncome} </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The details you gave for your landlord are as follows:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Landlords Name</td> <td class="td-second"> ${initializedLandlordsFirstName}, ${initializedLandlordsSurName} </td> </tr> <tr> <td class="td-first">Landlords Email Address</td> <td class="td-second"> ${initializedLandlordsEmailAddress} </td> </tr> <tr> <td class="td-first">Landlords Phone number</td> <td class="td-second"> ${initializedLandlordsPhoneNumber}</td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="paragraph_block block-9" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:180%;text-align:left;mso-line-height-alt:28.8px;"> <p style="margin: 0;">We just need some further information, we have sent the attached (Landlords permission form) directly to your landlord for them to sign and return</p> </div> </td> </tr> </table> <table class="button_block block-10" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="left"> <a href="https://n1o66cn1nv1.typeform.com/to/EoRJHIfy#deal_id=${initializedDealId}" target="_blank" style="text-decoration:none;display:inline-block;color:#ffffff;background-color:#ff8623;border-radius:4px;width:auto;border-top:0px solid transparent;font-weight:400;border-right:0px solid transparent;border-bottom:0px solid transparent;border-left:0px solid transparent;padding-top:5px;padding-bottom:5px;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;text-align:center;mso-border-alt:none;word-break:keep-all;"><span style="padding-left:20px;padding-right:20px;font-size:16px;display:inline-block;letter-spacing:normal;"><span style="word-break: break-word; line-height: 32px;">Click here to complete your application</span></span></a> </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"> </div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Once we have completed our preliminary checks, you will receive further correspondence via email or one of our senior advisors will call you from 0800 994 9456.</p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});

// ECO HOT LEADS
app.post('/eco-hot-leads', async (req, res) => {
  try {
    // Get email details from the request body
    const { email, fullName, clientName, houseNumberOrName, postcode, residentialStatus, epcRating, epcNumber, newBoilerInstalled, heatingSystem, benefitsReceived, apiKey } = req.body;

    const initializeWithMissingInfo = (value) => (value === "" || value === "undefined" || value === "null" || value === undefined || value === null) ? "missing info" : value;

    // Applying the function to each variable
    const initializedEmail = initializeWithMissingInfo(email);

    const initializedfullName = initializeWithMissingInfo(fullName);
    const initializedClientName = initializeWithMissingInfo(clientName);
    const initializedHouseNumberOrName = initializeWithMissingInfo(houseNumberOrName);
    const initializedPostcode = initializeWithMissingInfo(postcode);
    const initializedResidentialStatus = initializeWithMissingInfo(residentialStatus);
    const initializedEpcRating = initializeWithMissingInfo(epcRating);
    const initializedEpcNumber = initializeWithMissingInfo(epcNumber);
    const initializedHeatingSystem = initializeWithMissingInfo(heatingSystem);
    const initializedBenefitsReceived = initializeWithMissingInfo(benefitsReceived);
    const initializedNewBoilerInstalled = initializeWithMissingInfo(newBoilerInstalled);
    const initializedApiKey = initializeWithMissingInfo(apiKey);

    // Create a Nodemailer transporter
    const transporter = nodemailer.createTransport({
      host: "smtp.ionos.co.uk",
      port: 465,
      secure: true, // upgrade later with STARTTLS
      auth: {
        user: 'info@ecogrants.online', // Your email address
        pass: '12345DarRob2@16' // Your email password (consider using environment variables)
      }
    });
    const subjectComplete = initializedfullName + " - ECO4GRANT - GREAT NEWS!!";

    const htmlTemplate = `<!DOCTYPE html> <html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" lang="en"> <head> <title></title> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900" rel="stylesheet" type="text/css"> <style> * { box-sizing: border-box; } body { margin: 0; padding: 0; } a[x-apple-data-detectors] { color: inherit !important; text-decoration: inherit !important; } #MessageViewBody a { color: inherit; text-decoration: none; } p { line-height: inherit } .desktop_hide, .desktop_hide table { mso-hide: all; display: none; max-height: 0px; overflow: hidden; } .image_block img+div { display: none; } @media (max-width:615px) { .desktop_hide table.icons-inner { display: inline-block !important; } .icons-inner { text-align: center; } .icons-inner td { margin: 0 auto; } .image_block div.fullWidth { max-width: 100% !important; } .mobile_hide { display: none; } .row-content { width: 100% !important; } .stack .column { width: 100%; display: block; } .mobile_hide { min-height: 0; max-height: 0; max-width: 0; overflow: hidden; font-size: 0px; } .desktop_hide, .desktop_hide table { display: table !important; max-height: none !important; } .row-1 .column-1 .block-12.paragraph_block td.pad>div, .row-1 .column-1 .block-18.paragraph_block td.pad>div, .row-1 .column-1 .block-2.paragraph_block td.pad>div, .row-1 .column-1 .block-3.paragraph_block td.pad>div, .row-1 .column-1 .block-4.paragraph_block td.pad>div, .row-1 .column-1 .block-9.paragraph_block td.pad>div { font-size: 14px !important; } .row-1 .column-1 .block-10.button_block a, .row-1 .column-1 .block-10.button_block div, .row-1 .column-1 .block-10.button_block span, .row-1 .column-1 .block-5.button_block a, .row-1 .column-1 .block-5.button_block div, .row-1 .column-1 .block-5.button_block span { font-size: 14px !important; line-height: 28px !important; } .row-1 .column-1 .block-13.image_block td.pad, .row-1 .column-1 .block-14.image_block td.pad { padding: 10px !important; } .row-1 .column-1 .block-17.paragraph_block td.pad>div { text-align: left !important; font-size: 14px !important; } } .our-class { padding: 8px; font-size: 14px; } .td-first { font-weight: 600; background-color: #f5f5f5; } .td-second { font-style: italic; } table.GeneratedTable { width: 100%; background-color: #ffffff; border-collapse: collapse; border-width: 1px; border-color: #ff8603; border-style: solid; color: #000000; text-align: left; } table.GeneratedTable td, table.GeneratedTable th { border-width: 2px; border-color: #ff8603; border-style: solid; padding: 10px; } </style> </head> <body style="background-color: #ffffff; margin: 0; padding: 0; -webkit-text-size-adjust: none; text-size-adjust: none;"> <table class="nl-container" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; background-color: #ffffff;"> <tbody> <tr> <td> <table class="row row-1" align="center" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tbody> <tr> <td> <table class="row-content stack" align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #000000; width: 595px; margin: 0 auto;" width="595"> <tbody> <tr> <td class="column column-1" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; font-weight: 400; text-align: left; padding-bottom: 5px; padding-top: 5px; vertical-align: top; border-top: 0px; border-right: 0px; border-bottom: 0px; border-left: 0px;"> <table class="image_block block-1" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-2" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:120%;text-align:left;mso-line-height-alt:19.2px;"> <p style="margin: 0;">Hi ${initializedClientName}, </p> </div> </td> </tr> </table> <table class="paragraph_block block-3" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Thank you for completing our online survey form, we have now completed our preliminary checks and we believe you may be entitled to a Government Grant which will significantly reduce both your energy bills and your carbon footprint.</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">The Governments Eco4 Grant is designed to improve your standard of living and reduce your monthly heating bills! Giving you a warmer, more energy efficient home whilst reducing your impact on the planet :)</p> </div> </td> </tr> </table> <table class="paragraph_block block-4" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">From the information supplied below it appears that you may qualify, however we do need to speak to you to clarify a couple of points before we can 100% confirm your eligibility. </p> </div> </td> </tr> </table> <table class="divider_block block-6" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-7" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0; font-weight: 700;">Information we currently have about you and your property:</p> </div> </td> </tr> </table> <table class="html_block block-8" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div style="font-family:Arial, Helvetica, sans-serif;text-align:center;" align="center"> <div class="our-class"> <table class="GeneratedTable"> <tbody> <tr> <td class="td-first">Residential Status</td> <td class="td-second"> You are a ${initializedResidentialStatus} @ ${initializedHouseNumberOrName}, ${initializedPostcode} </td> </tr> <tr> <td class="td-first">EPC Rating</td> <td class="td-second"> Your property's energy Performance Certificate is ${initializedEpcRating}, ${initializedEpcNumber}</td> </tr> <tr> <td class="td-first">Benefits</td> <td class="td-second">You are currently in receipt of ${initializedBenefitsReceived} </td> </tr> <tr> <td class="td-first">New Boiler (in last 15 Yrs)</td> <td class="td-second"> ${initializedNewBoilerInstalled} </td> </tr> <tr> <td class="td-first">Current Heating System </td> <td class="td-second"> ${initializedHeatingSystem} </td> </tr> </tbody> </table> </div> </div> </td> </tr> </table> <table class="divider_block block-11" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block desktop_hide block-12" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#000000;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:center;mso-line-height-alt:24px;"> <p style="margin: 0;"><strong>Potential improvement measures and benefits available for qualifying Homeowners and Private Tenants</strong></p> </div> </td> </tr> </table> <table class="image_block block-13 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="center" style="line-height:10px"> <div class="fullWidth" style="max-width: 595px;"> <img src="https://app.neuzmail.in/files/65771efa8be29/table01-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"> </div> </div> </td> </tr> </table> <table class="image_block block-14 desktop_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; mso-hide: all; display: none; max-height: 0; overflow: hidden;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 450px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table0211-9900000000079e3c.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="450"></div> </div> </td> </tr> </table> <table class="image_block block-15 mobile_hide" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;"> <div class="alignment" align="center" style="line-height:10px"> <div style="max-width: 595px;"><img src="https://app.neuzmail.in/files/65771efa8be29/table_02.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="595"></div> </div> </td> </tr> </table> <table class="divider_block block-16" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">One of our senior advisors will call you shortly from 0800 994 9456, if you have a preferred date/time or any further information on your Heating system, please reply to this mail. </p> </div> </td> </tr> </table> <table class="paragraph_block block-17" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:16px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:24px;"> <p style="margin: 0;">Alternatively feel free to call us directly on the number above or email us info@ecogrants.online </p> </div> </td> </tr> </table> <table class="paragraph_block block-18" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:14px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:21px;"> <p style="margin: 0;"><strong>Kind Regards,</strong><br><strong>Darren Robson</strong><br>Head of Eco Grants Team<br>0800 994 9456</p> </div> </td> </tr> </table> <table class="divider_block block-19" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad"> <div class="alignment" align="center"> <table border="0" cellpadding="0" cellspacing="0" role="presentation" width="100%" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="divider_inner" style="font-size: 1px; line-height: 1px; border-top: 1px solid #dddddd;"> <span> </span> </td> </tr> </table> </div> </td> </tr> </table> <table class="image_block block-20" width="100%" border="0" cellpadding="0" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt;"> <tr> <td class="pad" style="width:100%;padding-right:0px;padding-left:0px;"> <div class="alignment" align="left" style="line-height:10px"> <div style="max-width: 208.25px;"><img src="https://app.neuzmail.in/files/65771efa8be29/EGO_logo-01.jpg" style="display: block; height: auto; border: 0; width: 100%;" width="208.25"></div> </div> </td> </tr> </table> <table class="paragraph_block block-21" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>ecogrants.online is wholly owned by ClaimPal Limited, a company registered in England and Wales, number 14211616. Registered office: 281 Palatine Road, Northenden, Manchester M22 4ET</em> </p> </div> </td> </tr> </table> <table class="paragraph_block block-22" width="100%" border="0" cellpadding="10" cellspacing="0" role="presentation" style="mso-table-lspace: 0pt; mso-table-rspace: 0pt; word-break: break-word;"> <tr> <td class="pad"> <div style="color:#101112;direction:ltr;font-family:'Roboto', Tahoma, Verdana, Segoe, sans-serif;font-size:10px;font-weight:400;letter-spacing:0px;line-height:150%;text-align:left;mso-line-height-alt:15px;"> <p style="margin: 0;"><em>This e‑mail (including any attachments) is private and confidential and may contain privileged material. If you have received this email in error, please notify the sender and delete it (including any attachments) immediately. You must not copy, distribute, disclose or use any of the information in it or any attachments. Telephone calls may be monitored or recorded.</em></p> </div> </td> </tr> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`;

    const mailOptions = {
      from: '"Eco4Grants" <info@ecogrants.online>',
      to: initializedEmail,
      subject: subjectComplete,
      text: 'Thank you for your enquiry regarding the ECO4 Government Grant.',
      html: htmlTemplate
    };
    // Send email
    const info = await transporter.sendMail(mailOptions);

    console.log('Email sent: ', info.messageId);

    // Respond to the client
    res.status(200).json({ success: true, message: 'Email sent successfully', userApiKey: initializedApiKey, messageId: info.messageId, emailSubject: subjectComplete, emailTemplate: htmlTemplate });
  } catch (error) {
    console.error('Error sending email:', error.message);
    res.status(500).json({ success: false, message: 'Error sending email' });
  }
});



app.get('/', (req, res) => {
  res.send('Hello, this is the root route!');
});

// Start the server
app.listen(PORT, () => {
  console.log(`Server is running on http://localhost:${PORT}`);
});
